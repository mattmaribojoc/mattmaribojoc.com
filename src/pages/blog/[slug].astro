---
import { useStoryblokApi } from '@storyblok/astro'
import StoryblokComponent from '@storyblok/astro/StoryblokComponent.astro'
import Layout from '../../layouts/Layout.astro'

const { slug } = Astro.params

const storyblokApi = useStoryblokApi()

export async function getStaticPaths() {
  const storyblokApi = useStoryblokApi()

  const { data } = await storyblokApi.get(`cdn/links`, {
    version: 'draft'
  })

  const links = Object.values(data.links).filter(
    (link: any) => !link.is_folder && link.slug.startsWith('blog/')
  )

  return [
    links.map((link: any) => ({
      params: { slug: link.slug.replace('blog/', '') }
    }))
  ]
}

const { data } = await storyblokApi.get(`cdn/stories/blog/${slug}`, {
  version: 'draft'
})

const story = data.story
---

<Layout title={story.content.title}>
  <StoryblokComponent blok={story.content} />
</Layout>
